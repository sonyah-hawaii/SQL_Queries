-- WHICH COUNTIES HAVE HIGHEST FREQUENCY OF SALES WITH WHISKEY OR VODKA PRODUCTS?

SELECT COUNTY, AVG(*) AS SALE_FREQUENCY
FROM
(SELECT COUNTY, CATEGORY_NAME, TOTAL,
CASE WHEN
	CATEGORY_NAME LIKE '%WHISKIES%' OR CATEGORY_NAME LIKE '%VODKA%' THEN 1
    ELSE 0
END AS ALC_TYPE FROM SALES) AS TEMP

WHERE ALC_TYPE = 1
GROUP BY COUNTY
ORDER BY SALE_FREQUENCY DESC

--WHAT IS AVERAGE % OF SALES WHERE PROOF > 80 PER COUNTY?

SELECT COUNTY, AVG(OVER_80) AS PCT_OVER_80
FROM
(SELECT COUNTY, 
 CASE
 	WHEN PROOF >= '80' THEN 1
 	ELSE 0
 	END AS OVER_80
FROM SALES A
INNER JOIN PRODUCTS B
ON A.ITEM=B.ITEM_NO)
AS TEMP
GROUP BY COUNTY
ORDER BY PCT_OVER_80 DESC

-- WHAT ARE THE TOP FIVE COUNTIES RE: ML PER CAPITA

SELECT COUNTY, CAST(ML_TOTAL AS NUMERIC)/POPULATION AS ML_PER_CAPITA
FROM COUNTIES A
INNER JOIN
(SELECT COUNTY, SUM(LITER_SIZE * BOTTLE_QTY) AS ML_TOTAL
FROM SALES
AS TEMP
GROUP BY COUNTY) B
USING (COUNTY)
ORDER BY ML_PER_CAPITA DESC
LIMIT 5
